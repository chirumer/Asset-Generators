<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Round Table Occupancy — SVG/PNG Generator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #0f1115;
      --panel: #171a21;
      --ink: #e6e9ef;
      --ink-dim: #b7beca;
      --accent: #6ea8fe;
      --accent-2: #8bd5ff;
      --ok: #6f9267;
      --danger: #e06c75;
      --ring: rgba(110,168,254,.35);
      --border: #262a33;
      --chip-bg: #1f2430;
      --chip-on: #2b3342;
      --chip-ring: rgba(255,255,255,.12);
      --btn: #2a2f3a;
      --btn-hover: #343b49;
      --btn-border: #394151;
      --radius: 14px;
      --radius-sm: 10px;
      --shadow: 0 8px 28px rgba(0,0,0,.40), 0 2px 10px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      color: var(--ink);
      background: radial-gradient(1200px 900px at 10% -10%, #18202b 0%, #0f1115 55%);
      font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    .wrap {
      max-width: 1100px;
      margin: 28px auto 56px;
      padding: 0 18px;
    }
    header {
      margin-bottom: 18px;
      display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
    }
    h1 {
      font-size: 22px; margin: 0;
      letter-spacing: .2px;
      font-weight: 700;
    }
    .tagline {
      color: var(--ink-dim);
      margin-left: auto;
      font-size: 13px;
      opacity: .9;
    }

    .card {
      background: linear-gradient(180deg, var(--panel), #12151b);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: clip;
    }

    .grid {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 18px;
    }
    @media (max-width: 960px) {
      .grid { grid-template-columns: 1fr; }
    }

    /* Controls */
    .controls { padding: 18px; }
    .group { margin-bottom: 16px; }
    .group:last-child { margin-bottom: 0; }
    .label {
      display: block; margin-bottom: 8px;
      font-weight: 600; letter-spacing: .2px;
    }
    .row {
      display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
    }
    input[type="number"] {
      width: 96px;
      appearance: textfield;
      padding: 10px 12px;
      color: var(--ink);
      background: var(--chip-bg);
      border: 1px solid var(--btn-border);
      border-radius: var(--radius-sm);
      outline: none;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.02);
    }
    input[type="number"]:focus { border-color: var(--accent); box-shadow: 0 0 0 6px var(--ring); }

    .chips {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }
    @media (max-width: 420px) {
      .chips { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    .chip {
      display: inline-flex;
      align-items: center; justify-content: center;
      gap: 8px;
      background: var(--chip-bg);
      border: 1px solid var(--btn-border);
      color: var(--ink);
      padding: 9px 10px;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      transition: background .15s ease, border-color .15s ease, transform .02s ease;
    }
    .chip input { display: none; }
    .chip[data-on="true"] {
      background: var(--chip-on);
      border-color: #4b5568;
    }
    .chip:hover { background: #232836; }
    .chip:active { transform: translateY(1px); }
    .chip small {
      color: var(--ink-dim);
      letter-spacing: .2px;
    }

    .hint {
      color: var(--ink-dim);
      margin-top: 6px;
      font-size: 12px;
    }

    /* Preview */
    .preview {
      display: grid;
      gap: 12px;
      padding: 14px;
    }
    .svg-wrap {
      display: grid; place-items: center;
      padding: 18px;
      background:
        radial-gradient(60% 40% at 60% 15%, rgba(255,255,255,.03), transparent 60%),
        linear-gradient(180deg, #131720, #0f1218);
      border-bottom: 1px solid var(--border);
    }
    .svg-shell {
      background: conic-gradient(from 190deg at 60% 20%, rgba(255,255,255,.06), rgba(255,255,255,0) 25%),
                  radial-gradient(60% 60% at 50% 40%, rgba(255,255,255,.06), rgba(255,255,255,0) 70%);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid #283042;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }

    .actions {
      display: flex; gap: 10px; flex-wrap: wrap;
      padding: 12px 14px 18px;
      align-items: center;
    }
    .actions .spacer { flex: 1; }
    button {
      appearance: none;
      border: 1px solid var(--btn-border);
      background: linear-gradient(180deg, var(--btn), #242a35);
      color: var(--ink);
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600; letter-spacing: .2px;
      box-shadow: 0 1px 0 rgba(255,255,255,.03);
    }
    button:hover { background: var(--btn-hover); }
    button.primary {
      border-color: #3f6ed6;
      background: linear-gradient(180deg, #2c60dd, #2b55c3);
      box-shadow: 0 6px 18px rgba(46, 121, 255, .25), inset 0 1px 0 rgba(255,255,255,.06);
    }
    button.primary:hover { filter: brightness(1.03); }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 8px;
      background: #1f2533;
      border: 1px solid #2d3445;
      color: var(--ink-dim);
      font-size: 12px;
    }

    .error {
      color: #ff9096;
      background: rgba(224,108,117,.08);
      border: 1px solid rgba(224,108,117,.35);
      padding: 8px 10px;
      border-radius: 10px;
      display: none;
      margin-top: 10px;
    }

    /* Make the chairs clickable without impacting export */
    .seat-hit {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Round Table Occupancy — SVG/PNG Generator</h1>
      <div class="tagline">Seat <strong>0</strong> is at the <strong>top</strong>, then clockwise. Max 8 seats.</div>
    </header>

    <div class="grid">
      <!-- Controls -->
      <section class="card controls" aria-label="Controls">
        <div class="group">
          <label for="numSeats" class="label">1) Number of seats (1–8)</label>
          <div class="row">
            <input id="numSeats" type="number" min="1" max="8" step="1" value="6" />
            <span class="badge" id="centerBadge">Center shows seat count</span>
          </div>
          <div class="hint">Changing the seat count keeps existing selections when possible.</div>
        </div>

        <div class="group">
          <div class="label">2) Which seats are occupied</div>
          <div id="chips" class="chips" aria-live="polite" aria-label="Seat occupancy toggles"></div>
          <div class="hint">Toggle any seat below or click a chair in the preview.</div>
          <div id="err" class="error" role="alert">Error</div>
        </div>
      </section>

      <!-- Preview + Actions -->
      <section class="card preview" aria-label="Preview and export">
        <div class="svg-wrap">
          <div class="svg-shell">
            <!-- ViewBox units: table radius = 100; full frame = 460 -->
            <svg id="tableSvg" width="420" height="420" viewBox="-230 -230 460 460"
                 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                 aria-label="Round table preview" role="img">
              <!-- We draw into #scene -->
              <g id="scene"></g>
            </svg>
          </div>
        </div>
        <div class="actions">
          <div>
            <span class="badge" id="occBadge">Occupancy: <code id="occText">000000</code></span>
          </div>
          <div class="spacer"></div>
          <button id="downloadSvgBtn" class="primary" type="button">Download SVG</button>
          <button id="downloadPngBtn" type="button">Download PNG</button>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ---------- Theme from the Python reference ----------
    const TABLE_MAIN = "#E7C27D";
    const TABLE_CENTER = "#F3D7A3";
    const TABLE_OUTLINE = "#000000";
    const RIM_DARK = "#C08E5A";

    const CHAIR_OUTLINE = "#3E2A16";
    const CHAIR_SEAT = "#D2A670";
    const CHAIR_SEAT_INNER = "#E6C08E";
    const CHAIR_BACK = "#BF9058";
    const CHAIR_SHADOW_ALPHA = 0.14;

    const NUM_FILL = "#7A4E22";
    const NUM_STROKE_COLOR = "#FFF2DC";
    const NUM_SIZE_RATIO = 0.12;   // of diameter
    const NUM_OUTLINE_RATIO = 0.007;

    const SHIRT_COLORS = ["#4F6FA3", "#6F9267", "#B25E3B", "#8A4661", "#C2A24A", "#408080"];
    const SKIN_TONES   = ["#F1C27D", "#E0AC69", "#C68642", "#8D5524", "#B47C4F"];

    // Geometry (SVG "data units")
    const TABLE_RADIUS = 100;     // base radius in SVG units
    const SEAT_DISTANCE = 1.62;   // relative to table radius
    const X_LIM = 230;            // viewBox is [-230, 230]^2

    // Chair geometry (scaled from Python)
    const seat_w = 60, seat_d = 36, back_h = 15, back_gap = 6, lw_chair = 3.2;

    // People tokens
    const body_r = 30, head_r = 18, outlinePerson = "#2B2B2B", lw_person = 2.2;

    // --------- State ----------
    const state = {
      numSeats: 6,
      occupied: Array(6).fill(0)
    };

    const svg = document.getElementById('tableSvg');
    const scene = document.getElementById('scene');
    const chipsEl = document.getElementById('chips');
    const occText = document.getElementById('occText');
    const errEl = document.getElementById('err');
    const numSeatsInput = document.getElementById('numSeats');

    // --------- Helpers ----------
    function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }

    function seatAnglesDeg(n) {
      if (n === 1) return [90];
      const step = 360 / n;
      return Array.from({length: n}, (_, i) => 90 - i*step);
    }

    function toRad(deg){ return deg * Math.PI / 180; }

    function clear(el){ while (el.firstChild) el.removeChild(el.firstChild); }

    function setAttrs(el, attrs) {
      for (const [k,v] of Object.entries(attrs)) el.setAttribute(k, v);
      return el;
    }

    function el(name, attrs={}, children=[]) {
      const n = document.createElementNS("http://www.w3.org/2000/svg", name);
      setAttrs(n, attrs);
      for (const c of children) n.appendChild(c);
      return n;
    }

    function occupancyString() { return state.occupied.join(''); }

    function validateState() {
      let msg = "";
      if (!(1 <= state.numSeats && state.numSeats <= 8)) msg = "`num_seats` must be 1..8";
      if (state.occupied.length !== state.numSeats) msg = "`occupied` length must equal `num_seats`";
      if (state.occupied.some(x => x !== 0 && x !== 1)) msg = "`occupied` values must be 0 or 1";
      if (msg) {
        errEl.textContent = msg;
        errEl.style.display = "block";
        return false;
      }
      errEl.style.display = "none";
      return true;
    }

    // --------- Drawing primitives ----------
    function drawTable(g) {
      // Drop shadow under table
      g.appendChild(el('ellipse', {
        cx: 0, cy: -5, rx: 120, ry: 21, fill: 'black', 'fill-opacity': .12
      }));

      // Table circles + highlight
      g.appendChild(el('circle', {
        cx:0, cy:0, r: TABLE_RADIUS, fill: TABLE_MAIN, stroke: TABLE_OUTLINE, 'stroke-width': 4.5
      }));
      g.appendChild(el('circle', { cx:0, cy:0, r: TABLE_RADIUS*0.82, fill: TABLE_CENTER }));
      g.appendChild(el('circle', { cx:0, cy:0, r: TABLE_RADIUS*0.98,
        fill:'none', stroke: RIM_DARK, 'stroke-width': 2.2, 'stroke-opacity': .45
      }));
      g.appendChild(el('ellipse', {
        cx: -28, cy: 35, rx: 60, ry: 35, transform:'rotate(20 -28 35)', fill: 'white', 'fill-opacity': .18
      }));
    }

    function drawChair(parent, cx, cy, angleDeg, seatIndex) {
      const rot = angleDeg - 90;  // same as Python (before global flip applied below)
      const group = el('g', { transform: `translate(${cx} ${cy}) rotate(${rot})` });

      // Shadow
      group.appendChild(el('ellipse', {
        cx: 0, cy: 0, rx: seat_w*0.45, ry: seat_d*0.35,
        fill: 'black', 'fill-opacity': CHAIR_SHADOW_ALPHA
      }));

      // Backrest (outward from seat) -> NOTE: y negative because our preview flips y later
      group.appendChild(el('rect', {
        x: -seat_w/2, y: -(seat_d/2 + back_gap + back_h),
        width: seat_w, height: back_h, rx: 8, ry: 8,
        fill: CHAIR_BACK, stroke: CHAIR_OUTLINE, 'stroke-width': lw_chair
      }));

      // Seat
      group.appendChild(el('rect', {
        x: -seat_w/2, y: -seat_d/2,
        width: seat_w, height: seat_d, rx: 10, ry: 10,
        fill: CHAIR_SEAT, stroke: CHAIR_OUTLINE, 'stroke-width': lw_chair
      }));

      // Inner highlight
      const gloss = el('ellipse', {
        cx: -seat_w*0.06, cy: seat_d*0.08,
        rx: seat_w*0.275, ry: seat_d*0.21,
        fill: CHAIR_SEAT_INNER, 'fill-opacity': .65
      });
      group.appendChild(gloss);

      // Top gloss
      group.appendChild(el('ellipse', {
        cx: -seat_w*0.18, cy: -seat_d*0.04,
        rx: seat_w*0.15, ry: seat_d*0.075,
        fill: 'white', 'fill-opacity': .18
      }));

      // Hit target (does not export as special; it's normal SVG)
      const hit = el('circle', {
        class: 'seat-hit', cx: 0, cy: 0, r: Math.max(seat_w, seat_d)*0.7,
        fill: 'transparent', 'data-seat': seatIndex
      });
      hit.addEventListener('click', () => toggleSeat(seatIndex));
      group.appendChild(hit);

      parent.appendChild(group);
    }

    function drawPeople(parent, centers, occ) {
      centers.forEach(([sx, sy], i) => {
        if (occ[i] !== 1) return;

        const bodyCol = SHIRT_COLORS[i % SHIRT_COLORS.length];
        const headCol = SKIN_TONES[i % SKIN_TONES.length];

        // Vector toward center
        let vx = -sx, vy = -sy;
        const m = Math.hypot(vx, vy) || 1;
        const ux = vx / m, uy = vy / m;

        const body_cx = sx + ux * 6;  // 0.06 * TABLE_RADIUS
        const body_cy = sy + uy * 6;
        const head_cx = sx + ux * (body_r + head_r * 0.7);
        const head_cy = sy + uy * (body_r + head_r * 0.7);

        // Halo
        parent.appendChild(el('ellipse', {
          cx: sx, cy: sy,
          rx: body_r*1.3, ry: body_r*1.3,
          fill: 'none', stroke: '#FFFFFF', 'stroke-opacity': .55, 'stroke-width': 1.5
        }));

        // Body
        parent.appendChild(el('circle', {
          cx: body_cx, cy: body_cy, r: body_r,
          fill: bodyCol, stroke: outlinePerson, 'stroke-width': lw_person
        }));

        // Head
        parent.appendChild(el('circle', {
          cx: head_cx, cy: head_cy, r: head_r,
          fill: headCol, stroke: outlinePerson, 'stroke-width': lw_person
        }));
      });
    }

    function addCenterNumber(parent, numSeats) {
      // Desired font size proportional to diameter
      const diameter = TABLE_RADIUS * 2;
      const targetPx = diameter * NUM_SIZE_RATIO;        // in "SVG units" (1 == 1px for our purposes)
      const outline = diameter * NUM_OUTLINE_RATIO;

      // Text is drawn inside a flipped group to render upright
      const tgroup = el('g', { transform: 'scale(1,-1)' });
      const t = el('text', {
        x: 0, y: 0, 'text-anchor':'middle', 'dominant-baseline':'central',
        'font-size': targetPx, 'font-weight':'700',
        fill: NUM_FILL, stroke: NUM_STROKE_COLOR, 'stroke-width': outline, 'paint-order':'stroke'
      });
      t.textContent = String(numSeats);
      tgroup.appendChild(t);
      parent.appendChild(tgroup);
    }

    // --------- Renderer ----------
    function render() {
      clear(scene);

      const gWorld = el('g', { transform: 'scale(1,-1)' }); // flip Y so math coords match Python logic

      // Table
      drawTable(gWorld);

      // Seats & centers
      const r = SEAT_DISTANCE * TABLE_RADIUS;
      const angles = seatAnglesDeg(state.numSeats);
      const centers = [];

      angles.forEach((ang, i) => {
        const a = toRad(ang);
        const cx = r * Math.cos(a);
        const cy = r * Math.sin(a);
        centers.push([cx, cy]);
        drawChair(gWorld, cx, cy, ang, i);
      });

      // People tokens
      drawPeople(gWorld, centers, state.occupied);

      // Center number
      addCenterNumber(gWorld, state.numSeats);

      scene.appendChild(gWorld);

      // UI mirrors
      occText.textContent = occupancyString();
      validateState();
    }

    // --------- Controls (chips/checkboxes) ----------
    function rebuildChips() {
      clear(chipsEl);
      for (let i = 0; i < state.numSeats; i++) {
        const lab = document.createElement('label');
        lab.className = 'chip';
        lab.dataset.on = String(state.occupied[i] === 1);
        lab.title = i === 0 ? 'Seat 0 (top)' : `Seat ${i}`;
        const input = document.createElement('input');
        input.type = 'checkbox';
        input.checked = state.occupied[i] === 1;
        input.setAttribute('aria-label', `Seat ${i} occupied`);
        input.addEventListener('change', () => toggleSeat(i));
        const span = document.createElement('span');
        span.textContent = `Seat ${i}`;
        const sm = document.createElement('small');
        sm.textContent = i === 0 ? 'top' : 'cw';
        lab.append(input, span, sm);
        chipsEl.appendChild(lab);
      }
    }

    function syncChips() {
      [...chipsEl.querySelectorAll('.chip')].forEach((chip, i) => {
        chip.dataset.on = String(state.occupied[i] === 1);
        const input = chip.querySelector('input');
        input.checked = state.occupied[i] === 1;
      });
    }

    function toggleSeat(i) {
      state.occupied[i] = state.occupied[i] === 1 ? 0 : 1;
      syncChips();
      render();
    }

    // --------- Events ----------
    numSeatsInput.addEventListener('input', () => {
      const before = state.numSeats;
      const next = clamp(parseInt(numSeatsInput.value || "0", 10), 1, 8);
      numSeatsInput.value = String(next);
      state.numSeats = next;

      // Preserve existing selections where possible
      const old = state.occupied.slice();
      state.occupied = Array(next).fill(0);
      for (let i = 0; i < Math.min(old.length, next); i++) state.occupied[i] = old[i];

      rebuildChips();
      render();
    });

    // --------- Export ----------
    function serializeSvg() {
      const clone = svg.cloneNode(true);
      // Ensure width/height set to match viewBox export nicely
      clone.setAttribute('width', '1024');
      clone.setAttribute('height', '1024');
      return new XMLSerializer().serializeToString(clone);
    }

    function downloadBlob(data, filename, type) {
      const blob = new Blob([data], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    document.getElementById('downloadSvgBtn').addEventListener('click', () => {
      if (!validateState()) return;
      const name = `table_${state.numSeats}_occ.svg`;
      const data = serializeSvg();
      downloadBlob(data, name, 'image/svg+xml;charset=utf-8');
    });

    document.getElementById('downloadPngBtn').addEventListener('click', async () => {
      if (!validateState()) return;
      const svgData = serializeSvg();
      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(svgBlob);

      const img = new Image();
      // No crossOrigin needed; we embed no external resources
      const done = new Promise((resolve, reject) => { img.onload = resolve; img.onerror = reject; });
      img.src = url;
      await done;

      const canvas = document.createElement('canvas');
      const size = 1024; // export size
      canvas.width = size; canvas.height = size;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, size, size);
      ctx.drawImage(img, 0, 0, size, size);
      URL.revokeObjectURL(url);

      canvas.toBlob((blob) => {
        const a = document.createElement('a');
        const blobUrl = URL.createObjectURL(blob);
        a.href = blobUrl;
        a.download = `table_${state.numSeats}_occ.png`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(blobUrl);
      }, 'image/png');
    });

    // --------- Init ----------
    (function init(){
      rebuildChips();
      render();
    })();
  </script>
</body>
</html>
