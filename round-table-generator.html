<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Round Table Occupancy — SVG/PNG Generator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      color-scheme: dark;
      --bg-0: #010417;
      --bg-1: #020921;
      --bg-2: #06112f;
      --surface: rgba(11, 20, 45, 0.85);
      --surface-strong: rgba(16, 29, 58, 0.95);
      --ink: #e2e8f0;
      --ink-dim: #98a7c3;
      --ink-soft: rgba(148, 163, 184, 0.6);
      --accent: #60a5fa;
      --accent-strong: #38bdf8;
      --danger: #f87171;
      --shadow-lg: 0 30px 70px rgba(4, 12, 27, 0.65);
      --shadow-sm: 0 12px 30px rgba(6, 17, 47, 0.45);
      --radius: clamp(16px, 1.8vw, 24px);
      --radius-sm: clamp(10px, 1.4vw, 16px);
      --border: rgba(99, 122, 176, 0.28);
      --ring: rgba(96, 165, 250, 0.24);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Plus Jakarta Sans", system-ui, -apple-system, "Segoe UI", sans-serif;
      background:
        radial-gradient(120% 160% at 90% 0%, rgba(56, 189, 248, 0.22), transparent 55%),
        radial-gradient(140% 120% at 0% 8%, rgba(14, 165, 233, 0.18), transparent 60%),
        linear-gradient(180deg, var(--bg-0) 0%, var(--bg-2) 100%);
      color: var(--ink);
      display: flex;
      flex-direction: column;
    }

    .page {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .container {
      width: min(1180px, 92vw);
      margin: 0 auto;
    }

    .topbar {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(16px);
      background: linear-gradient(180deg, rgba(2, 6, 23, 0.92) 0%, rgba(2, 6, 23, 0.6) 100%);
      border-bottom: 1px solid rgba(148, 163, 184, 0.08);
    }

    .topbar-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: clamp(1rem, 3vw, 1.75rem);
      padding: clamp(1rem, 2.8vw, 1.6rem) 0;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 1rem;
      text-decoration: none;
      color: inherit;
    }

    .brand-mark {
      width: clamp(42px, 5vw, 56px);
      height: clamp(42px, 5vw, 56px);
      border-radius: 20px;
      background: linear-gradient(135deg, #2a5a7a 0%, #1a3a52 100%);
      border: 1px solid rgba(56, 189, 248, 0.4);
      box-shadow: 0 8px 24px rgba(8, 47, 73, 0.35);
      display: grid;
      place-items: center;
      position: relative;
      overflow: hidden;
    }

    .brand-mark::after {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 20%, rgba(148, 197, 255, 0.28), transparent 65%);
      opacity: 0.8;
    }

    .brand-mark svg {
      width: clamp(22px, 3vw, 30px);
      height: clamp(22px, 3vw, 30px);
      stroke: var(--ink);
      stroke-width: 1.5;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
      position: relative;
      z-index: 1;
    }

    .brand h1 {
      margin: 0;
      font-size: clamp(1.15rem, 2.4vw, 1.4rem);
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .brand span {
      display: block;
      margin-top: 0.25rem;
      color: var(--ink-soft);
      font-size: clamp(0.8rem, 1.4vw, 0.92rem);
    }

    .topbar .cta-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1.2rem;
      border-radius: 14px;
      text-decoration: none;
      color: var(--ink);
      border: 1px solid rgba(56, 189, 248, 0.45);
      background: rgba(56, 189, 248, 0.14);
      font-weight: 500;
      transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
    }

    .topbar .cta-link svg {
      width: 16px;
      height: 16px;
    }

    .topbar .cta-link:hover {
      transform: translateY(-1px);
      border-color: rgba(125, 211, 252, 0.85);
      background: rgba(56, 189, 248, 0.22);
    }

    main {
      flex: 1;
      padding: clamp(2.5rem, 6vw, 4.5rem) 0 clamp(3.5rem, 7vw, 5rem);
    }

    .layout {
      display: grid;
      gap: clamp(1.75rem, 3vw, 2.5rem);
      grid-template-columns: minmax(0, 360px) minmax(0, 1fr);
      align-items: start;
    }

    .panel {
      background: var(--surface);
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: var(--shadow-lg);
      padding: clamp(1.6rem, 3vw, 2.2rem);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -25% -10% auto;
      height: clamp(180px, 32vw, 240px);
      background: radial-gradient(circle at center, rgba(148, 197, 255, 0.18), transparent 70%);
      opacity: 0;
      transition: opacity 0.35s ease;
      pointer-events: none;
    }

    .panel:hover::before {
      opacity: 1;
    }

    .panel-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: clamp(1rem, 2vw, 1.4rem);
    }

    .panel-title {
      margin: 0;
      font-size: clamp(1.2rem, 2vw, 1.45rem);
      letter-spacing: -0.01em;
      font-weight: 600;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.65rem;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.12);
      border: 1px solid rgba(148, 163, 184, 0.28);
      color: var(--ink-soft);
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .panel-controls {
      display: grid;
      gap: clamp(1.4rem, 3vw, 2rem);
    }

    .control-group {
      display: grid;
      gap: 0.75rem;
    }

    .field-label {
      font-weight: 600;
      letter-spacing: 0.02em;
      font-size: 0.95rem;
    }

    .field-label span {
      color: var(--ink-soft);
      font-weight: 500;
    }

    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.85rem;
      align-items: center;
    }

    input[type="number"] {
      appearance: textfield;
      width: clamp(90px, 16vw, 120px);
      padding: 0.75rem 0.85rem;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(148, 163, 184, 0.32);
      background: rgba(10, 21, 45, 0.78);
      color: var(--ink);
      font-size: 1rem;
      letter-spacing: 0.01em;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: rgba(96, 165, 250, 0.85);
      box-shadow: 0 0 0 6px var(--ring);
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      margin: 0;
      appearance: none;
    }

    .chips {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 0.75rem;
    }

    .chip {
      position: relative;
      display: inline-flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 0.35rem;
      padding: 0.65rem 0.8rem;
      background: rgba(12, 22, 48, 0.78);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(148, 163, 184, 0.24);
      color: var(--ink);
      font-weight: 500;
      cursor: pointer;
      user-select: none;
      transition: transform 0.18s ease, border-color 0.18s ease, background 0.18s ease;
    }

    .chip input {
      display: none;
    }

    .chip small {
      color: var(--ink-soft);
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    .chip[data-on="true"] {
      background: rgba(56, 189, 248, 0.16);
      border-color: rgba(96, 165, 250, 0.55);
      box-shadow: 0 10px 20px rgba(14, 165, 233, 0.22);
    }

    .chip:hover {
      transform: translateY(-1px);
      border-color: rgba(125, 211, 252, 0.55);
    }

    .hint {
      color: var(--ink-soft);
      font-size: 0.82rem;
      line-height: 1.6;
    }

    .panel-preview {
      display: grid;
      gap: clamp(1.5rem, 2.8vw, 2.3rem);
      padding: clamp(1.8rem, 3vw, 2.4rem);
      background: var(--surface-strong);
      box-shadow: var(--shadow-sm);
    }

    .preview-stage {
      display: grid;
      gap: 1.15rem;
    }

    .stage {
      display: grid;
      place-items: center;
      border-radius: calc(var(--radius) * 0.85);
      padding: clamp(1.2rem, 3.6vw, 2rem);
      background:
        radial-gradient(64% 58% at 60% 22%, rgba(255, 255, 255, 0.12), transparent 65%),
        linear-gradient(135deg, rgba(12, 25, 58, 0.92), rgba(7, 16, 36, 0.9));
      border: 1px solid rgba(148, 163, 184, 0.16);
    }

    .svg-shell {
      width: min(440px, 82vw);
      max-width: 100%;
      border-radius: 22px;
      padding: 1rem;
      background: rgba(9, 18, 40, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.12);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.85rem;
    }

    .actions .spacer {
      flex: 1;
    }

    button {
      appearance: none;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(96, 165, 250, 0.45);
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.32), rgba(14, 165, 233, 0.65));
      color: var(--ink);
      padding: 0.75rem 1.1rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      cursor: pointer;
      transition: transform 0.2s ease, filter 0.2s ease, border-color 0.2s ease;
    }

    button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      border-color: rgba(125, 211, 252, 0.75);
    }

    button.secondary {
      background: rgba(15, 25, 49, 0.92);
      border-color: rgba(148, 163, 184, 0.3);
    }

    .badge-inline {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.22);
      color: var(--ink-soft);
      font-size: 0.8rem;
    }

    .error {
      display: none;
      margin-top: 0.6rem;
      padding: 0.65rem 0.8rem;
      border-radius: var(--radius-sm);
      background: rgba(248, 113, 113, 0.14);
      border: 1px solid rgba(248, 113, 113, 0.35);
      color: var(--danger);
      font-size: 0.88rem;
    }

    .hint-strong {
      color: var(--ink-soft);
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .seat-hit {
      cursor: pointer;
    }

    @media (max-width: 1100px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .panel-controls {
        order: 1;
      }

      .panel-preview {
        order: 2;
      }
    }

    @media (max-width: 620px) {
      .topbar-inner {
        flex-direction: column;
        align-items: flex-start;
      }

      .topbar .cta-link {
        width: 100%;
        justify-content: center;
      }

      .actions {
        flex-direction: column;
        align-items: stretch;
      }

      .actions .spacer {
        display: none;
      }

      .actions button {
        width: 100%;
      }

      .badge-inline {
        width: 100%;
        justify-content: center;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        transition-duration: 0.01ms !important;
        animation-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body>
    <div class="page">
      <header class="topbar">
        <div class="container topbar-inner">
          <a class="brand" href="index.html">
            <span class="brand-mark" aria-hidden="true">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 12H5M12 5l-7 7 7 7" stroke-width="1.4" />
              </svg>
            </span>
            <div>
              <h1>Round Table Occupancy Generator</h1>
              <span>Configure seat layouts and export instantly</span>
            </div>
          </a>
          <a class="cta-link" href="https://github.com/" target="_blank" rel="noopener">
            View docs
            <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3.5 12.5 12.5 3.5M12.5 3.5H4.75M12.5 3.5V11.25" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </a>
        </div>
      </header>

    <main>
      <div class="container layout">
        <!-- Controls -->
        <section class="panel panel-controls" aria-label="Controls">
          <div class="panel-header">
            <span class="badge">Step 1</span>
            <h2 class="panel-title">Configure your table</h2>
          </div>

          <div class="control-group">
            <label for="numSeats" class="field-label">Number of seats <span>(1–8)</span></label>
            <div class="field-row">
              <input id="numSeats" type="number" min="1" max="8" step="1" value="6" />
              <span class="badge-inline" id="centerBadge">Center shows seat count</span>
            </div>
            <div class="hint">Adjust the seat count first. Existing selections are preserved when possible.</div>
          </div>

          <div class="control-group">
            <div class="panel-header" style="margin-bottom:0.5rem">
              <span class="badge">Step 2</span>
              <h2 class="panel-title" style="font-size:1.05rem">Toggle occupied seats</h2>
            </div>
            <div id="chips" class="chips" aria-live="polite" aria-label="Seat occupancy toggles"></div>
            <div class="hint">Tap any seat chip below or click a chair in the preview.</div>
            <div id="err" class="error" role="alert">Error</div>
            <div class="hint-strong">Seat 0 starts at the top and increments clockwise.</div>
          </div>
        </section>

        <!-- Preview + Actions -->
        <section class="panel panel-preview" aria-label="Preview and export">
          <div class="panel-header" style="margin-bottom:0">
            <span class="badge">Step 3</span>
            <h2 class="panel-title">Preview &amp; export</h2>
          </div>

          <div class="preview-stage">
            <div class="stage">
              <div class="svg-shell">
                <!-- ViewBox units: table radius = 100; full frame = 460 -->
                <svg id="tableSvg" width="420" height="420" viewBox="-230 -230 460 460"
                     xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                     aria-label="Round table preview" role="img">
                  <!-- We draw into #scene -->
                  <g id="scene"></g>
                </svg>
              </div>
            </div>

            <div class="actions">
              <span class="badge-inline" id="occBadge">Occupancy: <code id="occText">000000</code></span>
              <div class="spacer"></div>
              <button id="downloadSvgBtn" type="button">Download SVG</button>
              <button id="downloadPngBtn" class="secondary" type="button">Download PNG</button>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>
</body>
  <script>
    // ---------- Theme from the Python reference ----------
    const TABLE_MAIN = "#E7C27D";
    const TABLE_CENTER = "#F3D7A3";
    const TABLE_OUTLINE = "#000000";
    const RIM_DARK = "#C08E5A";

    const CHAIR_OUTLINE = "#3E2A16";
    const CHAIR_SEAT = "#D2A670";
    const CHAIR_SEAT_INNER = "#E6C08E";
    const CHAIR_BACK = "#BF9058";
    const CHAIR_SHADOW_ALPHA = 0.14;

    const NUM_FILL = "#7A4E22";
    const NUM_STROKE_COLOR = "#FFF2DC";
    const NUM_SIZE_RATIO = 0.12;   // of diameter
    const NUM_OUTLINE_RATIO = 0.007;

    const SHIRT_COLORS = ["#4F6FA3", "#6F9267", "#B25E3B", "#8A4661", "#C2A24A", "#408080"];
    const SKIN_TONES   = ["#F1C27D", "#E0AC69", "#C68642", "#8D5524", "#B47C4F"];

    // Geometry (SVG "data units")
    const TABLE_RADIUS = 100;     // base radius in SVG units
    const SEAT_DISTANCE = 1.62;   // relative to table radius
    const X_LIM = 230;            // viewBox is [-230, 230]^2

    // Chair geometry (scaled from Python)
    const seat_w = 60, seat_d = 36, back_h = 15, back_gap = 6, lw_chair = 3.2;

    // People tokens
    const body_r = 30, head_r = 18, outlinePerson = "#2B2B2B", lw_person = 2.2;

    // --------- State ----------
    const state = {
      numSeats: 6,
      occupied: Array(6).fill(0)
    };

    const svg = document.getElementById('tableSvg');
    const scene = document.getElementById('scene');
    const chipsEl = document.getElementById('chips');
    const occText = document.getElementById('occText');
    const errEl = document.getElementById('err');
    const numSeatsInput = document.getElementById('numSeats');

    // --------- Helpers ----------
    function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }

    function seatAnglesDeg(n) {
      if (n === 1) return [90];
      const step = 360 / n;
      return Array.from({length: n}, (_, i) => 90 - i*step);
    }

    function toRad(deg){ return deg * Math.PI / 180; }

    function clear(el){ while (el.firstChild) el.removeChild(el.firstChild); }

    function setAttrs(el, attrs) {
      for (const [k,v] of Object.entries(attrs)) el.setAttribute(k, v);
      return el;
    }

    function el(name, attrs={}, children=[]) {
      const n = document.createElementNS("http://www.w3.org/2000/svg", name);
      setAttrs(n, attrs);
      for (const c of children) n.appendChild(c);
      return n;
    }

    function occupancyString() { return state.occupied.join(''); }

    function validateState() {
      let msg = "";
      if (!(1 <= state.numSeats && state.numSeats <= 8)) msg = "`num_seats` must be 1..8";
      if (state.occupied.length !== state.numSeats) msg = "`occupied` length must equal `num_seats`";
      if (state.occupied.some(x => x !== 0 && x !== 1)) msg = "`occupied` values must be 0 or 1";
      if (msg) {
        errEl.textContent = msg;
        errEl.style.display = "block";
        return false;
      }
      errEl.style.display = "none";
      return true;
    }

    // --------- Drawing primitives ----------
    function drawTable(g) {
      // Drop shadow under table
      g.appendChild(el('ellipse', {
        cx: 0, cy: -5, rx: 120, ry: 21, fill: 'black', 'fill-opacity': .12
      }));

      // Table circles + highlight
      g.appendChild(el('circle', {
        cx:0, cy:0, r: TABLE_RADIUS, fill: TABLE_MAIN, stroke: TABLE_OUTLINE, 'stroke-width': 4.5
      }));
      g.appendChild(el('circle', { cx:0, cy:0, r: TABLE_RADIUS*0.82, fill: TABLE_CENTER }));
      g.appendChild(el('circle', { cx:0, cy:0, r: TABLE_RADIUS*0.98,
        fill:'none', stroke: RIM_DARK, 'stroke-width': 2.2, 'stroke-opacity': .45
      }));
      g.appendChild(el('ellipse', {
        cx: -28, cy: 35, rx: 60, ry: 35, transform:'rotate(20 -28 35)', fill: 'white', 'fill-opacity': .18
      }));
    }

    function drawChair(parent, cx, cy, angleDeg, seatIndex) {
      const rot = angleDeg - 90;  // same as Python (before global flip applied below)
      const group = el('g', { transform: `translate(${cx} ${cy}) rotate(${rot})` });

      // Shadow
      group.appendChild(el('ellipse', {
        cx: 0, cy: 0, rx: seat_w*0.45, ry: seat_d*0.35,
        fill: 'black', 'fill-opacity': CHAIR_SHADOW_ALPHA
      }));

      // Backrest (outward from seat) -> NOTE: y negative because our preview flips y later
      group.appendChild(el('rect', {
        x: -seat_w/2, y: -(seat_d/2 + back_gap + back_h),
        width: seat_w, height: back_h, rx: 8, ry: 8,
        fill: CHAIR_BACK, stroke: CHAIR_OUTLINE, 'stroke-width': lw_chair
      }));

      // Seat
      group.appendChild(el('rect', {
        x: -seat_w/2, y: -seat_d/2,
        width: seat_w, height: seat_d, rx: 10, ry: 10,
        fill: CHAIR_SEAT, stroke: CHAIR_OUTLINE, 'stroke-width': lw_chair
      }));

      // Inner highlight
      const gloss = el('ellipse', {
        cx: -seat_w*0.06, cy: seat_d*0.08,
        rx: seat_w*0.275, ry: seat_d*0.21,
        fill: CHAIR_SEAT_INNER, 'fill-opacity': .65
      });
      group.appendChild(gloss);

      // Top gloss
      group.appendChild(el('ellipse', {
        cx: -seat_w*0.18, cy: -seat_d*0.04,
        rx: seat_w*0.15, ry: seat_d*0.075,
        fill: 'white', 'fill-opacity': .18
      }));

      // Hit target (does not export as special; it's normal SVG)
      const hit = el('circle', {
        class: 'seat-hit', cx: 0, cy: 0, r: Math.max(seat_w, seat_d)*0.7,
        fill: 'transparent', 'data-seat': seatIndex
      });
      hit.addEventListener('click', () => toggleSeat(seatIndex));
      group.appendChild(hit);

      parent.appendChild(group);
    }

    function drawPeople(parent, centers, occ) {
      centers.forEach(([sx, sy], i) => {
        if (occ[i] !== 1) return;

        const bodyCol = SHIRT_COLORS[i % SHIRT_COLORS.length];
        const headCol = SKIN_TONES[i % SKIN_TONES.length];

        // Vector toward center
        let vx = -sx, vy = -sy;
        const m = Math.hypot(vx, vy) || 1;
        const ux = vx / m, uy = vy / m;

        const body_cx = sx + ux * 6;  // 0.06 * TABLE_RADIUS
        const body_cy = sy + uy * 6;
        const head_cx = sx + ux * (body_r + head_r * 0.7);
        const head_cy = sy + uy * (body_r + head_r * 0.7);

        // Halo
        parent.appendChild(el('ellipse', {
          cx: sx, cy: sy,
          rx: body_r*1.3, ry: body_r*1.3,
          fill: 'none', stroke: '#FFFFFF', 'stroke-opacity': .55, 'stroke-width': 1.5
        }));

        // Body
        parent.appendChild(el('circle', {
          cx: body_cx, cy: body_cy, r: body_r,
          fill: bodyCol, stroke: outlinePerson, 'stroke-width': lw_person
        }));

        // Head
        parent.appendChild(el('circle', {
          cx: head_cx, cy: head_cy, r: head_r,
          fill: headCol, stroke: outlinePerson, 'stroke-width': lw_person
        }));
      });
    }

    function addCenterNumber(parent, numSeats) {
      // Desired font size proportional to diameter
      const diameter = TABLE_RADIUS * 2;
      const targetPx = diameter * NUM_SIZE_RATIO;        // in "SVG units" (1 == 1px for our purposes)
      const outline = diameter * NUM_OUTLINE_RATIO;

      // Text is drawn inside a flipped group to render upright
      const tgroup = el('g', { transform: 'scale(1,-1)' });
      const t = el('text', {
        x: 0, y: 0, 'text-anchor':'middle', 'dominant-baseline':'central',
        'font-size': targetPx, 'font-weight':'700',
        fill: NUM_FILL, stroke: NUM_STROKE_COLOR, 'stroke-width': outline, 'paint-order':'stroke'
      });
      t.textContent = String(numSeats);
      tgroup.appendChild(t);
      parent.appendChild(tgroup);
    }

    // --------- Renderer ----------
    function render() {
      clear(scene);

      const gWorld = el('g', { transform: 'scale(1,-1)' }); // flip Y so math coords match Python logic

      // Table
      drawTable(gWorld);

      // Seats & centers
      const r = SEAT_DISTANCE * TABLE_RADIUS;
      const angles = seatAnglesDeg(state.numSeats);
      const centers = [];

      angles.forEach((ang, i) => {
        const a = toRad(ang);
        const cx = r * Math.cos(a);
        const cy = r * Math.sin(a);
        centers.push([cx, cy]);
        drawChair(gWorld, cx, cy, ang, i);
      });

      // People tokens
      drawPeople(gWorld, centers, state.occupied);

      // Center number
      addCenterNumber(gWorld, state.numSeats);

      scene.appendChild(gWorld);

      // UI mirrors
      occText.textContent = occupancyString();
      validateState();
    }

    // --------- Controls (chips/checkboxes) ----------
    function rebuildChips() {
      clear(chipsEl);
      for (let i = 0; i < state.numSeats; i++) {
        const lab = document.createElement('label');
        lab.className = 'chip';
        lab.dataset.on = String(state.occupied[i] === 1);
        lab.title = i === 0 ? 'Seat 0 (top)' : `Seat ${i}`;
        const input = document.createElement('input');
        input.type = 'checkbox';
        input.checked = state.occupied[i] === 1;
        input.setAttribute('aria-label', `Seat ${i} occupied`);
        input.addEventListener('change', () => toggleSeat(i));
        const span = document.createElement('span');
        span.textContent = `Seat ${i}`;
        const sm = document.createElement('small');
        sm.textContent = i === 0 ? 'top' : 'cw';
        lab.append(input, span, sm);
        chipsEl.appendChild(lab);
      }
    }

    function syncChips() {
      [...chipsEl.querySelectorAll('.chip')].forEach((chip, i) => {
        chip.dataset.on = String(state.occupied[i] === 1);
        const input = chip.querySelector('input');
        input.checked = state.occupied[i] === 1;
      });
    }

    function toggleSeat(i) {
      state.occupied[i] = state.occupied[i] === 1 ? 0 : 1;
      syncChips();
      render();
    }

    // --------- Events ----------
    numSeatsInput.addEventListener('input', () => {
      const before = state.numSeats;
      const next = clamp(parseInt(numSeatsInput.value || "0", 10), 1, 8);
      numSeatsInput.value = String(next);
      state.numSeats = next;

      // Preserve existing selections where possible
      const old = state.occupied.slice();
      state.occupied = Array(next).fill(0);
      for (let i = 0; i < Math.min(old.length, next); i++) state.occupied[i] = old[i];

      rebuildChips();
      render();
    });

    // --------- Export ----------
    function serializeSvg() {
      const clone = svg.cloneNode(true);
      // Ensure width/height set to match viewBox export nicely
      clone.setAttribute('width', '1024');
      clone.setAttribute('height', '1024');
      return new XMLSerializer().serializeToString(clone);
    }

    function downloadBlob(data, filename, type) {
      const blob = new Blob([data], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    document.getElementById('downloadSvgBtn').addEventListener('click', () => {
      if (!validateState()) return;
      const name = `table_${state.numSeats}_occ.svg`;
      const data = serializeSvg();
      downloadBlob(data, name, 'image/svg+xml;charset=utf-8');
    });

    document.getElementById('downloadPngBtn').addEventListener('click', async () => {
      if (!validateState()) return;
      const svgData = serializeSvg();
      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(svgBlob);

      const img = new Image();
      // No crossOrigin needed; we embed no external resources
      const done = new Promise((resolve, reject) => { img.onload = resolve; img.onerror = reject; });
      img.src = url;
      await done;

      const canvas = document.createElement('canvas');
      const size = 1024; // export size
      canvas.width = size; canvas.height = size;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, size, size);
      ctx.drawImage(img, 0, 0, size, size);
      URL.revokeObjectURL(url);

      canvas.toBlob((blob) => {
        const a = document.createElement('a');
        const blobUrl = URL.createObjectURL(blob);
        a.href = blobUrl;
        a.download = `table_${state.numSeats}_occ.png`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(blobUrl);
      }, 'image/png');
    });

    // --------- Init ----------
    (function init(){
      rebuildChips();
      render();
    })();
  </script>
</body>
</html>
